<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="../assets/css/calc.css">
    <meta charset="UTF-8">
    <title>Revoloop Credit Calculator</title>
</head>

<body>
<header>
  <nav>
    <ul>
      <li><a href="../index.html">Home</a></li>
      <li><a href="shop.html">Shop</a></li>
      <li><a href="about.html">About Us</a></li>
      <li><a href="services.html">Services</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
  <div class="translate-btn">
      <button onclick="location.href='../nederlands/calc.html'">üåê EN / NL</button>
  </div>
</header>

<section id="pla-calculator">
  <h2>Calculate Your Store Credit</h2>
  <p>Return your PLA waste and instantly see how much store credit you earn.</p>

  <form id="calc-form">
    <label for="email">Email Address (optional)</label>
    <input id="email" type="email" placeholder="you@example.com" />

    <label for="weight">How many kilograms of PLA are you returning?</label>
    <input id="weight" type="number" min="0" step="0.01" value="1" required />

    <label for="quality">Material condition (value per kg in ‚Ç¨)</label>
    <select id="quality">
      <option value="0.20">Mixed / contaminated (‚Ç¨0.20/kg)</option>
      <option value="0.50" selected>Clean (‚Ç¨0.50/kg)</option>
      <option value="1.00">Sorted & clean (‚Ç¨1.00/kg)</option>
    </select>

    <label for="customer">Customer Type</label>
    <select id="customer">
      <option value="Individual" selected>Individual</option>
      <option value="Makerspace">Makerspace</option>
      <option value="Other">Other</option>
    </select>

    <button type="button" id="calc">Calculate Store Credit (in cents)</button>
  </form>

  <!-- Appointment button OUTSIDE the form -->
  <div id="appointment">
      <a id="appointment-button" href="appointment.html">Make an Appointment</a>
  </div>

  <div id="result" style="display:none; margin-top:1.5rem;">
    <h3>You will receive:</h3>
    <p id="credit" style="font-size:1.5rem; font-weight:700; color:#006400;">0</p>
    <p id="note" style="color:#333;">‚Äî</p>
  </div>
</section>

<section id="log">
  <h3>Calculation History</h3>
  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>Customer</th>
        <th>Kilograms</th>
        <th>Quality (cent/kg)</th>
        <th>Credit (cent)</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="log-body"></tbody>
  </table>
</section>

<script>
const el = id => document.getElementById(id);
const fmt = v => Number.isFinite(v) ? v.toLocaleString('en-US') : '‚Äî';

function loadLog() {
  const log = JSON.parse(localStorage.getItem('revoloopLogCentEN') || '[]');
  const tbody = el('log-body');
  tbody.innerHTML = '';

  log.forEach(entry => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${entry.email || '‚Äî'}</td>
      <td>${entry.customer}</td>
      <td>${entry.weight} kg</td>
      <td>${fmt(entry.qualityCent)}</td>
      <td>${fmt(entry.credit)}</td>
      <td>${entry.date}</td>
    `;
    tbody.appendChild(row);
  });
}

function saveLog(entry) {
  const log = JSON.parse(localStorage.getItem('revoloopLogCentEN') || '[]');
  log.unshift(entry);
  localStorage.setItem('revoloopLogCentEN', JSON.stringify(log));
}

function calculate() {
  const weight = parseFloat(el('weight').value) || 0;
  const valueEuro = parseFloat(el('quality').value) || 0;
  const valueCent = Math.round(valueEuro * 100);
  const customer = el('customer').value;
  const factor = 1.2;

  const credit = Math.round(weight * valueCent * factor);

  const email = el('email').value.trim();
  const date = new Date().toLocaleString('en-GB');

  el('credit').textContent = fmt(credit);
  el('note').textContent = `${weight.toFixed(2)} kg √ó ${valueCent} cent/kg √ó 1.2 incentive`;
  el('result').style.display = 'block';

  const entry = { email, weight, qualityCent: valueCent, credit, customer, date };
  saveLog(entry);
  loadLog();

  // Show appointment button
  el('appointment').style.display = 'block';
}

el('calc').addEventListener('click', () => {
  calculate();
  el('credit').animate([{ transform: 'scale(1.05)' }, { transform: 'scale(1)' }], { duration: 250 });
});

loadLog();
</script>

</body>
</html>
