<!DOCTYPE html>
<html lang="nl">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="../assets/css/calc.css">
    <meta charset="UTF-8">
    <title>Revoloop Winkeltegoed Calculator</title>
</head>

<body>
<header>
  <nav>
    <ul>
      <li><a href="../index.html">Home</a></li>
      <li><a href="shop.html">Winkel</a></li>
      <li><a href="about.html">Over Ons</a></li>
      <li><a href="services.html">Diensten</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
  <div class="translate-btn">
      <button onclick="location.href='../engels/calc.html'">üåê NL / EN</button>
  </div>
</header>

<section id="pla-calculator">
  <h2>Bereken je winkeltegoed</h2>
  <p>Lever je PLA-afval in en zie direct hoeveel winkeltegoed je ontvangt.</p>

  <form id="calc-form">
    <label for="email">E-mailadres (optioneel)</label>
    <input id="email" type="email" placeholder="jij@voorbeeld.com" />

    <label for="weight">Aantal kilogram PLA dat je inlevert</label>
    <input id="weight" type="number" min="0" step="0.01" value="1" required />

    <label for="quality">Conditie van het materiaal (‚Ç¨ per kg)</label>
    <select id="quality">
      <option value="0.20">Gemengd / vervuild (‚Ç¨0,20/kg)</option>
      <option value="0.50" selected>Rein (‚Ç¨0,50/kg)</option>
      <option value="1.00">Gesorteerd & schoon (‚Ç¨1,00/kg)</option>
    </select>

    <label for="customer">Type klant</label>
    <select id="customer">
      <option value="Individu" selected>Individu</option>
      <option value="Makerspace">Makerspace</option>
      <option value="Overig">Overig</option>
    </select>

    <button type="button" id="calc">Bereken winkeltegoed (in centen)</button>
  </form>

  <!-- Appointment button OUTSIDE the form -->
  <div id="appointment">
      <a id="appointment-button" href="appointment.html">Maak afspraak</a>
  </div>

  <div id="result" style="display:none; margin-top:1.5rem;">
    <h3>Je ontvangt:</h3>
    <p id="credit" style="font-size:1.5rem; font-weight:700; color:#006400;">0</p>
    <p id="note" style="color:#333;">‚Äî</p>
  </div>
</section>

<section id="log">
  <h3>Berekeninggeschiedenis</h3>
  <table>
    <thead>
      <tr>
        <th>E-mail</th>
        <th>Klant</th>
        <th>Kilogram</th>
        <th>Conditiewaarde (cent/kg)</th>
        <th>Winkeltegoed (cent)</th>
        <th>Datum</th>
      </tr>
    </thead>
    <tbody id="log-body"></tbody>
  </table>
</section>

<script>
const el = id => document.getElementById(id);
const fmt = v => Number.isFinite(v) ? v.toLocaleString('nl-NL') : '‚Äî';

function loadLog() {
  const log = JSON.parse(localStorage.getItem('revoloopLogCentNL') || '[]');
  const tbody = el('log-body');
  tbody.innerHTML = '';

  log.forEach(entry => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${entry.email || '‚Äî'}</td>
      <td>${entry.customer}</td>
      <td>${entry.weight} kg</td>
      <td>${fmt(entry.qualityCent)}</td>
      <td>${fmt(entry.credit)}</td>
      <td>${entry.date}</td>
    `;
    tbody.appendChild(row);
  });
}

function saveLog(entry) {
  const log = JSON.parse(localStorage.getItem('revoloopLogCentNL') || '[]');
  log.unshift(entry);
  localStorage.setItem('revoloopLogCentNL', JSON.stringify(log));
}

function calculate() {
  const weight = parseFloat(el('weight').value) || 0;
  const valueEuro = parseFloat(el('quality').value) || 0;
  const valueCent = Math.round(valueEuro * 100);
  const customer = el('customer').value;
  const factor = 1.2;

  const credit = Math.round(weight * valueCent * factor);

  const email = el('email').value.trim();
  const date = new Date().toLocaleString('nl-NL');

  el('credit').textContent = fmt(credit);
  el('note').textContent = `${weight.toFixed(2)} kg √ó ${valueCent} cent/kg √ó 1,2 incentive`;
  el('result').style.display = 'block';

  const entry = { email, weight, qualityCent: valueCent, credit, customer, date };
  saveLog(entry);
  loadLog();

  // Show appointment button
  el('appointment').style.display = 'block';
}

el('calc').addEventListener('click', () => {
  calculate();
  el('credit').animate([{ transform: 'scale(1.05)' }, { transform: 'scale(1)' }], { duration: 250 });
});

loadLog();
</script>

</body>
</html>
